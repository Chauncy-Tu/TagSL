现在已经完成

1.单独测试解算部分没有问题，矩阵也不会出现内存泄漏

2.double buffer没有问题（之后试试最少可以压缩到多少）



现在存在的问题

1.时间同步，slot还是没有对齐

2.tdoa计算过程中问题，为什么变量变化（重启？不对啊，重启为什么agent重新初始化？）

3.串口输出问题——uart？明天再问一下肖老师

![image-20221215195821619](C:\Users\13690\AppData\Roaming\Typora\typora-user-images\image-20221215195821619.png)



试一下各自slot同步后差距

M_anchor slot0发送同步帧，然后在slot10发送test帧，各个S_Anchor分别在slot11 12 13 14发送test帧，看Sniffer接收时间。对比相邻接收时间差

0.0495031574581831
0.00582639371431791
0.00562496269030449
0.00515686146271535
0.00477133563701923

0.0494511944736579
0.00590181510729667
0.00560808373084435
0.00514503737229567
0.00472745932554587



0.0494515071145082
0.00589872472518530
0.00562229667467949
0.00516197941706731
0.00470602052346254



同步有问题！！！

![image-20221215204924090](C:\Users\13690\AppData\Roaming\Typora\typora-user-images\image-20221215204924090.png)

同步精度太差了

0.0494499998434996
0.0553851158572466
0.0609884021465595
0.0660667734312400
0.0708209231176132

??如何解决



如果不需要同步？



tdoa[0]=-131
tdoa[1]=-137
tdoa[2]=-146
tdoa[3]=-135
tdoa[4]=-320
tdoa[5]=-142
tdoa[6]=-125
tdoa[7]=-125
tdoa[8]=-152
tdoa[9]=-146
tdoa[10]=-135
tdoa[11]=-138
tdoa[12]=-140
tdoa[13]=-109
tdoa[14]=-134
tdoa[15]=-137
tdoa[16]=-139
tdoa[17]=-142
tdoa[18]=-152
tdoa[19]=-115
tdoa[20]=-139
tdoa[21]=-168
tdoa[22]=-158
tdoa[23]=-122
tdoa[24]=-174
tdoa[25]=-127
tdoa[26]=-158
tdoa[27]=-131
tdoa[28]=-137
tdoa[29]=-140
tdoa[30]=-142
tdoa[31]=-199
tdoa[32]=-161
tdoa[33]=-146
tdoa[34]=-110
tdoa[35]=-149
tdoa[36]=-116
tdoa[37]=-154
tdoa[38]=-165
tdoa[39]=-160
tdoa[40]=-140
tdoa[41]=-157
tdoa[42]=-138
tdoa[43]=-166
tdoa[44]=-154
tdoa[45]=-144
tdoa[46]=-128
tdoa[47]=-176
tdoa[48]=-163
tdoa[49]=-140
tdoa[50]=-165
tdoa[51]=-143
tdoa[52]=-130
tdoa[53]=-136
tdoa[54]=-145
tdoa[55]=-129
tdoa[56]=-139
tdoa[57]=-132
tdoa[58]=-120
tdoa[59]=-124
tdoa[60]=-136
tdoa[61]=-115
tdoa[62]=-124
tdoa[63]=-146
tdoa[64]=-99
tdoa[65]=-136
tdoa[66]=-106
tdoa[67]=-107
tdoa[68]=-150
tdoa[69]=-131
tdoa[70]=-150
tdoa[71]=-130
tdoa[72]=-170
tdoa[73]=-123
tdoa[74]=-157
tdoa[75]=-155
tdoa[76]=-137
tdoa[77]=-114
tdoa[78]=-131
tdoa[79]=-134
tdoa[80]=-147
tdoa[81]=-149
tdoa[82]=-152
tdoa[83]=-146
tdoa[84]=-127
tdoa[85]=-161
tdoa[86]=-117
tdoa[87]=-166
tdoa[88]=-117
tdoa[89]=-153
tdoa[90]=-131
tdoa[91]=-143
tdoa[92]=-118
tdoa[93]=-134
tdoa[94]=-101
tdoa[95]=-119
tdoa[96]=-131
tdoa[97]=-145
tdoa[98]=-138
tdoa[99]=-104
tdoa[100]=-109
tdoa[101]=-153
tdoa[102]=-131
tdoa[103]=-150
tdoa[104]=-130
tdoa[105]=-92
tdoa[106]=-136
tdoa[107]=-117
tdoa[108]=-154
tdoa[109]=-152
tdoa[110]=-122
tdoa[111]=-142
tdoa[112]=-292
tdoa[113]=-317
tdoa[114]=-125
tdoa[115]=-93
tdoa[116]=-326
tdoa[117]=-170
tdoa[118]=-117
tdoa[119]=-162
tdoa[120]=-127
tdoa[121]=-111
tdoa[122]=-129
tdoa[123]=-127
tdoa[124]=-98
tdoa[125]=-114
tdoa[126]=-101
tdoa[127]=-272
tdoa[128]=-276
tdoa[129]=-157
tdoa[130]=-119
tdoa[131]=-275
tdoa[132]=-185
tdoa[133]=-166
tdoa[134]=-139
tdoa[135]=-130
tdoa[136]=-155
tdoa[137]=-157
tdoa[138]=-164
tdoa[139]=-284
tdoa[140]=-289
tdoa[141]=-153
tdoa[142]=-196
tdoa[143]=-71
tdoa[144]=-125
tdoa[145]=-159
tdoa[146]=-145
tdoa[147]=-158
tdoa[148]=-140
tdoa[149]=-140
tdoa[150]=-156
tdoa[151]=-136
tdoa[152]=-174
tdoa[153]=-157
tdoa[154]=-133
tdoa[155]=-141
tdoa[156]=-114
tdoa[157]=-139
tdoa[158]=-136
tdoa[159]=-117
tdoa[160]=-146
tdoa[161]=-116
tdoa[162]=-143
tdoa[163]=-128
tdoa[164]=-125
tdoa[165]=-126
tdoa[166]=-154
tdoa[167]=-108
tdoa[168]=-169
tdoa[169]=-132
tdoa[170]=-150
tdoa[171]=-143
tdoa[172]=-126
tdoa[173]=-158
tdoa[174]=-131
tdoa[175]=-156
tdoa[176]=-139
tdoa[177]=-82
tdoa[178]=-164
tdoa[179]=-131
tdoa[180]=-165
tdoa[181]=-123
tdoa[182]=-160
tdoa[183]=-129
tdoa[184]=-137
tdoa[185]=-148
tdoa[186]=-158
tdoa[187]=-168
tdoa[188]=-133
tdoa[189]=-149
tdoa[190]=-102
tdoa[191]=-133
tdoa[192]=-112
tdoa[193]=-137
tdoa[194]=-136
tdoa[195]=-132
tdoa[196]=-141
tdoa[197]=-130
tdoa[198]=-162
tdoa[199]=-173
tdoa[200]=-114
tdoa[201]=-145
tdoa[202]=-143
tdoa[203]=-143
tdoa[204]=-145
tdoa[205]=-155
tdoa[206]=-158
tdoa[207]=-163
tdoa[208]=-126
tdoa[209]=-170
tdoa[210]=-100
tdoa[211]=-123
tdoa[212]=-123
tdoa[213]=-110
tdoa[214]=-137
tdoa[215]=-130
tdoa[216]=-315
tdoa[217]=-136
tdoa[218]=-122
tdoa[219]=-155
tdoa[220]=-142
tdoa[221]=-153
tdoa[222]=-118
tdoa[223]=-167
tdoa[224]=-118
tdoa[225]=-110
tdoa[226]=-140
tdoa[227]=-144
tdoa[228]=-129
tdoa[229]=-145
tdoa[230]=-288
tdoa[231]=-119
tdoa[232]=-113
tdoa[233]=-149
tdoa[234]=-92
tdoa[235]=-145
tdoa[236]=-115
tdoa[237]=-167
tdoa[238]=-102
tdoa[239]=-139
tdoa[240]=-288
tdoa[241]=-121
tdoa[242]=-123
tdoa[243]=-143
tdoa[244]=-142
tdoa[245]=-125
tdoa[246]=-131
tdoa[247]=-134
tdoa[248]=-310
tdoa[249]=-100
tdoa[250]=-105
tdoa[251]=-117
tdoa[252]=-125
tdoa[253]=-179
tdoa[254]=-99
tdoa[255]=-122
tdoa[256]=-111
tdoa[257]=-130
tdoa[258]=-102
tdoa[259]=-126
tdoa[260]=-115
tdoa[261]=-112
tdoa[262]=-345
tdoa[263]=-115
tdoa[264]=-140
tdoa[265]=-151
tdoa[266]=-157
tdoa[267]=-129
tdoa[268]=-135
tdoa[269]=-144
tdoa[270]=-157
tdoa[271]=-152
tdoa[272]=-73
tdoa[273]=-155
tdoa[274]=-139
tdoa[275]=-75
tdoa[276]=-151
tdoa[277]=-110
tdoa[278]=-131
tdoa[279]=-110
tdoa[280]=-87
tdoa[281]=-137
tdoa[282]=-127
tdoa[283]=-129
tdoa[284]=-114
tdoa[285]=-112
tdoa[286]=-117
tdoa[287]=-115
tdoa[288]=-101
tdoa[289]=-145
tdoa[290]=-119
tdoa[291]=-136
tdoa[292]=-164
tdoa[293]=-144
tdoa[294]=-122
tdoa[295]=-315
tdoa[296]=-120
tdoa[297]=-170
tdoa[298]=-141
tdoa[299]=-182
tdoa[300]=-157
tdoa[301]=-178
tdoa[302]=-310



-144.8113

 -136.0524



-138（筛选2个）

家里多径严重，考虑去外场校正和测试

另外考虑天线接线影响！！

明天计划

1.和肖老师确认一下蓝牙、串口和同步的问题

2.外场实验——校正天线参数 测试定位效果